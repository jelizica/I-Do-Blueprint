@startuml
title <size:24>Dynamic View: I Do Blueprint - macOS Application</size>\n<size:24>Repository delegates complex logic to domain service</size>

set separator none
left to right direction
skinparam ranksep 60
skinparam nodesep 30
hide stereotype

<style>
  root {
    BackgroundColor: #ffffff;
    FontColor: #444444;
  }
  // Element,Component,BusinessLogic
  .Element-RWxlbWVudCxDb21wb25lbnQsQnVzaW5lc3NMb2dpYw== {
    BackgroundColor: #f0e68c;
    LineColor: #a8a162;
    LineStyle: 0;
    LineThickness: 2;
    RoundCorner: 20;
    FontColor: #000000;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Component,Cache
  .Element-RWxlbWVudCxDb21wb25lbnQsQ2FjaGU= {
    BackgroundColor: #dda0dd;
    LineColor: #9a709a;
    LineStyle: 0;
    LineThickness: 2;
    RoundCorner: 20;
    FontColor: #000000;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Component,DataAccess
  .Element-RWxlbWVudCxDb21wb25lbnQsRGF0YUFjY2Vzcw== {
    BackgroundColor: #ffb6c1;
    LineColor: #b27f87;
    LineStyle: 0;
    LineThickness: 2;
    RoundCorner: 20;
    FontColor: #000000;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Component,Presentation
  .Element-RWxlbWVudCxDb21wb25lbnQsUHJlc2VudGF0aW9u {
    BackgroundColor: #90ee90;
    LineColor: #64a664;
    LineStyle: 0;
    LineThickness: 2;
    RoundCorner: 20;
    FontColor: #000000;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Component,StateManagement
  .Element-RWxlbWVudCxDb21wb25lbnQsU3RhdGVNYW5hZ2VtZW50 {
    BackgroundColor: #87ceeb;
    LineColor: #5e90a4;
    LineStyle: 0;
    LineThickness: 2;
    RoundCorner: 20;
    FontColor: #000000;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Element,Container,Database
  .Element-RWxlbWVudCxDb250YWluZXIsRGF0YWJhc2U= {
    BackgroundColor: #ff6b6b;
    LineColor: #b24a4a;
    LineStyle: 0;
    LineThickness: 2;
    RoundCorner: 20;
    FontColor: #ffffff;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
    MaximumWidth: 450;
  }
  // Relationship
  .Relationship-UmVsYXRpb25zaGlw {
    LineThickness: 2;
    LineStyle: 10-10;
    LineColor: #444444;
    FontColor: #444444;
    FontSize: 24;
  }
  // I Do Blueprint
  .Boundary-SSBEbyBCbHVlcHJpbnQ= {
    BackgroundColor: #ffffff;
    LineColor: #0b4884;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #1168bd;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
  // macOS Application
  .Boundary-bWFjT1MgQXBwbGljYXRpb24= {
    BackgroundColor: #ffffff;
    LineColor: #2e6295;
    LineStyle: 0;
    LineThickness: 2;
    FontColor: #438dd5;
    FontSize: 24;
    HorizontalAlignment: center;
    Shadowing: 0;
  }
</style>

rectangle "I Do Blueprint\n<size:16>[Software System]</size>" <<Boundary-SSBEbyBCbHVlcHJpbnQ=>> {
  rectangle "macOS Application\n<size:16>[Container: Swift, SwiftUI, Combine, Swift Concurrency]</size>" <<Boundary-bWFjT1MgQXBwbGljYXRpb24=>> {
    rectangle "==View Layer\n<size:16>[Component: SwiftUI, @Environment, @StateObject]</size>\n\nSwiftUI views and UI components with @Environment injection" <<Element-RWxlbWVudCxDb21wb25lbnQsUHJlc2VudGF0aW9u>> as IDoBlueprint.macOSApplication.ViewLayer
    rectangle "==Store Layer\n<size:16>[Component: @MainActor, ObservableObject, @Published, Combine]</size>\n\nFeature stores (BudgetStoreV2, GuestStoreV2, etc.) with @MainActor isolation" <<Element-RWxlbWVudCxDb21wb25lbnQsU3RhdGVNYW5hZ2VtZW50>> as IDoBlueprint.macOSApplication.StoreLayer
    rectangle "==Repository Layer\n<size:16>[Component: async/await, Protocols, NetworkRetry, Sentry]</size>\n\nProtocol-based data access with caching, retry logic, and error tracking" <<Element-RWxlbWVudCxDb21wb25lbnQsRGF0YUFjY2Vzcw==>> as IDoBlueprint.macOSApplication.RepositoryLayer
    rectangle "==RepositoryCache Actor\n<size:16>[Component: Swift Actor, Dictionary<String, CacheEntry>]</size>\n\nThread-safe in-memory cache with TTL expiration (60s default)" <<Element-RWxlbWVudCxDb21wb25lbnQsQ2FjaGU=>> as IDoBlueprint.macOSApplication.RepositoryCacheActor
    rectangle "==Domain Services Layer\n<size:16>[Component: Actor isolation, parallel async/await]</size>\n\nActor-based business logic and data aggregation services" <<Element-RWxlbWVudCxDb21wb25lbnQsQnVzaW5lc3NMb2dpYw==>> as IDoBlueprint.macOSApplication.DomainServicesLayer
  }

  rectangle "==Supabase Backend\n<size:16>[Container: PostgreSQL 15, PostgREST, Realtime, GoTrue Auth]</size>\n\nPostgreSQL database with Row Level Security, Realtime, and Auth" <<Element-RWxlbWVudCxDb250YWluZXIsRGF0YWJhc2U=>> as IDoBlueprint.SupabaseBackend
}

rectangle "==Supabase Backend\n<size:16>[Container: PostgreSQL 15, PostgREST, Realtime, GoTrue Auth]</size>\n\nPostgreSQL database with Row Level Security, Realtime, and Auth" <<Element-RWxlbWVudCxDb250YWluZXIsRGF0YWJhc2U=>> as IDoBlueprint.SupabaseBackend

IDoBlueprint.macOSApplication.StoreLayer --> IDoBlueprint.macOSApplication.RepositoryLayer <<Relationship-UmVsYXRpb25zaGlw>> : "1: 1. fetchBudgetOverview(scenarioId)"
IDoBlueprint.macOSApplication.RepositoryLayer --> IDoBlueprint.macOSApplication.DomainServicesLayer <<Relationship-UmVsYXRpb25zaGlw>> : "2: 2. Delegate to BudgetAggregationService"
IDoBlueprint.macOSApplication.DomainServicesLayer --> IDoBlueprint.SupabaseBackend <<Relationship-UmVsYXRpb25zaGlw>> : "3: 3. Parallel fetch: async let items, expenses, gifts"
IDoBlueprint.macOSApplication.DomainServicesLayer <-- IDoBlueprint.SupabaseBackend <<Relationship-UmVsYXRpb25zaGlw>> : "4: 4. Return all data"
IDoBlueprint.macOSApplication.RepositoryLayer <-- IDoBlueprint.macOSApplication.DomainServicesLayer <<Relationship-UmVsYXRpb25zaGlw>> : "5: 5. Return aggregated overview items"
IDoBlueprint.macOSApplication.RepositoryLayer --> IDoBlueprint.macOSApplication.RepositoryCacheActor <<Relationship-UmVsYXRpb25zaGlw>> : "6: 6. Cache aggregated result"
IDoBlueprint.macOSApplication.StoreLayer <-- IDoBlueprint.macOSApplication.RepositoryLayer <<Relationship-UmVsYXRpb25zaGlw>> : "7: 7. Return to store"
IDoBlueprint.macOSApplication.ViewLayer <-- IDoBlueprint.macOSApplication.StoreLayer <<Relationship-UmVsYXRpb25zaGlw>> : "8: 8. Display budget overview"

@enduml